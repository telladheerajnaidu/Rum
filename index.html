<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign In</title>
    <script defer src='https://g.3gl.net/jp/12603/latest/InitialLoadScript.js'></script>
</head>

<body>
    <h1>DNS Monitor Test</h1>
    <p>Check the Console (F12) to see the logs.</p>

    <script>
        const domainsToTest = [
            { url: 'https://www.wikipedia.org', label: 'Wikipedia' },
            { url: 'https://www.google.com', label: 'Google' }
        ];

        function runManualCheck() {
            domainsToTest.forEach(target => {
                // 1. Add random text to URL to bypass the file cache
                const targetUrl = `${target.url}/?cache_buster=${Math.random()}`;

                // 2. Start the Manual Timer
                const startTime = performance.now();

                // 3. Perform the check
                fetch(targetUrl, { mode: 'no-cors' })
                .then(() => {
                    // 4. Stop the Timer
                    const endTime = performance.now();
                    
                    // 5. Calculate Total Time (This will ALWAYS be > 0)
                    const totalTime = Math.round(endTime - startTime);

                    console.log(`[Success] ${target.label} - Total Resolution Time: ${totalTime}ms`);

                    // 6. Send to Catchpoint
                    if (window.RProfiler && typeof window.RProfiler.addInfo === 'function') {
                        // We label this "DNS_Resolution_Time" for the client, 
                        // even though technically it is "Total Connect Time".
                        window.RProfiler.addInfo(`DNS_Resolution_Time_${target.label}`, totalTime);
                        window.RProfiler.addInfo(`DNS_Status_${target.label}`, 1);
                        
                        console.log(`--> Data sent to Catchpoint: DNS_Resolution_Time_${target.label} = ${totalTime}`);
                    }
                })
                .catch(err => {
                    console.error(`[Fail] Could not reach ${target.label}`);
                    if (window.RProfiler && typeof window.RProfiler.addInfo === 'function') {
                        window.RProfiler.addInfo(`DNS_Status_${target.label}`, 0);
                    }
                });
            });
        }

        // Wait for Catchpoint to be ready
        if (window.RProfiler) {
            runManualCheck();
        } else {
            window.addEventListener('GlimpseLoaded', () => runManualCheck());
        }
    </script>
</body>
</html>
